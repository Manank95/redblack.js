(function(){function f(a,b){this.key=a,this.value=b,this.color=e,this.left=null,this.right=null,this.parent=null}function g(){this.root=null,this.balancer=new h(this)}function h(a){this.tree=a}function i(a){return a===null?d:a.color}function j(a,b){while(a!==null){if(b===a.key)return a;b<a.key?a=a.left:b>a.key&&(a=a.right)}return a}var a={},b=this,c=b.redblack;typeof module!="undefined"&&module.exports?module.exports=a:b.redblack=a,a.VERSION="0.1.0",a.noConflict=function(){return b.redblack=c,a},a.tree=function(){return new g};var d=a.BLACK="black",e=a.RED="red";f.prototype.grandparent=function(){return this.parent===null?null:this.parent.parent},f.prototype.sibling=function(){return this.parent===null?null:this===this.parent.left?this.parent.right:this.parent.left},f.prototype.uncle=function(){return this.parent===null?null:this.parent.sibling()},g.prototype.get=function(a){var b=j(this.root,a);return b===null?null:b.value},g.prototype.insert=function(a,b){var c=new f(a,b);if(this.root===null)this.root=c;else{var d=this.root;for(;;)if(a<d.key){if(d.left===null){d.left=c;break}d=d.left}else{if(!(a>d.key)){d.value=b;return}if(d.right===null){d.right=c;break}d=d.right}c.parent=d}this.balancer.inserted(c)},g.prototype.delete=function(a){var b=j(this.root,a);if(b===null)return;if(b.left!==null&&b.right!==null){var c=b.left;while(c.right!==null)c=c.right;b.key=c.key,b.value=c.value,b=c}var f=b.right===null?b.left:b.right;i(b)===d&&(b.color=i(f),this.balancer.deleted(b)),this.balancer.replaceNode(b,f),i(this.root)===e&&(this.root.color=d)},g.prototype.forEach=function(a){var b=this;(function c(d){if(d===null)return;c(d.left),a(d.value,d.key,b),c(d.right)})(this.root)},h.prototype.inserted=function(a){this.insertCase1(a)},h.prototype.deleted=function(a){this.deleteCase1(a)},h.prototype.replaceNode=function(a,b){a.parent===null?this.tree.root=b:a===a.parent.left?a.parent.left=b:a.parent.right=b,b!==null&&(b.parent=a.parent)},h.prototype.rotateLeft=function(a){var b=a.right;this.replaceNode(a,b),a.right=b.left,b.left!==null&&(b.left.parent=a),b.left=a,a.parent=b},h.prototype.rotateRight=function(a){var b=a.left;this.replaceNode(a,b),a.left=b.right,b.right!==null&&(b.right.parent=a),b.right=a,a.parent=b},h.prototype.insertCase1=function(a){a.parent===null?a.color=d:this.insertCase2(a)},h.prototype.insertCase2=function(a){if(i(a.parent)===d)return;this.insertCase3(a)},h.prototype.insertCase3=function(a){var b=a.uncle(),c=a.grandparent();b!==null&&i(b)===e?(a.parent.color=d,b.color=d,c.color=e,this.insertCase1(c)):this.insertCase4(a)},h.prototype.insertCase4=function(a){var b=a.grandparent();a===a.parent.right&&a.parent===b.left?(this.rotateLeft(a.parent),a=a.left):a===a.parent.left&&a.parent===b.right&&(this.rotateRight(a.parent),a=a.right),this.insertCase5(a)},h.prototype.insertCase5=function(a){var b=a.grandparent();a.parent.color=d,b.color=e,a===a.parent.left&&a.parent===b.right?this.rotateRight(b):this.rotateLeft(b)},h.prototype.deleteCase1=function(a){a.parent!==null&&this.deleteCase2(a)},h.prototype.deleteCase2=function(a){var b=a.sibling();i(b)===e&&(a.parent.color=e,b.color=d,a===a.parent.left?this.rotateLeft(a.parent):this.rotateRight(a.parent)),this.deleteCase3(a)},h.prototype.deleteCase3=function(a){var b=a.sibling();i(a.parent)===d&&i(b)===d&&i(b.left)===d&&i(b.right)===d?(b.color=e,this.deleteCase1(a.parent)):this.deleteCase4(a)},h.prototype.deleteCase4=function(a){var b=a.sibling();i(a.parent)===e&&i(b)===d&&i(b.left)===d&&i(b.right)===d?(b.color=e,a.parent.color=d):this.deleteCase5(a)},h.prototype.deleteCase5=function(a){var b=a.sibling();a===a.parent.left&&i(b)===d&&i(b.left)===e&&i(b.right)===d?(b.color=e,b.left.color=d,this.rotateRight(b)):a===a.parent.right&&i(b)===d&&i(b.right)===e&&i(b.left)===d&&(b.color=e,b.right.color=d,this.rotateLeft(b)),this.deleteCase6(a)},h.prototype.deleteCase6=function(a){var b=a.sibling();b.color=i(a.parent),a.parent.color=d,a===a.parent.left?(b.right.color=d,this.rotateLeft(a.parent)):(b.left.color=d,this.rotateRight(a.parent))}})();